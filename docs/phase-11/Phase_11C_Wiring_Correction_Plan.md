# Phase 11C Wiring Correction Plan

**Document Status:** Draft  
**Phase:** Planning Only  
**Execution:** Not Authorized  
**Created:** 2025-12-27  
**Last Updated:** 2025-12-27

---

## 1. CURRENT STATE (FACTUAL)

### 1.1 Runtime Stylesheet Loading

The public application (`apps/public`) currently loads styles via the following chain:

```
apps/public/src/main.tsx
    ‚îî‚îÄ‚îÄ imports ‚Üí apps/public/src/index.scss
                      ‚îî‚îÄ‚îÄ @import url('./assets/sass/style.css');  ‚Üê LINE 21
```

**Confirmed:** The active stylesheet at runtime is `apps/public/src/assets/sass/style.css`.

### 1.2 Static CSS Confirmation

The file `apps/public/src/assets/sass/style.css` is:
- A **pre-compiled, static CSS file** (6,469 lines)
- **Externally compiled** (not generated by Vite's SCSS preprocessor)
- Contains **hardcoded color values** (e.g., `#D90A2C` for theme color)
- Does NOT contain any `var(--theme-color)` references

**Evidence:**
```css
/* From style.css - hardcoded values */
.btn-theme {
  background-color: #D90A2C;
}
```

### 1.3 SCSS Master File Structure

The file `apps/public/src/assets/sass/style.scss` imports all SCSS partials:

```scss
// From style.scss - imports chain
@import "variables";
@import "mixins";
@import "common";
@import "header";
@import "footer";
@import "home1";
@import "home2";
@import "about";
@import "services";
@import "portfolio";
@import "project_details";
@import "blog_page";
@import "contact";
@import "commingsoon";
// ... additional partials
```

**Confirmed:** The SCSS partials modified in Phase 11C are imported via `style.scss`.

### 1.4 Phase 11C Visibility Status

| Phase | Files Modified | Contains var(--theme-color) | Loaded at Runtime |
|-------|----------------|----------------------------|-------------------|
| 11C-2 | _header.scss, _footer.scss, _common.scss | ‚úÖ Yes | ‚ùå No |
| 11C-3 | _blog_page.scss, _home2.scss, _project_details.scss, _portfolio.scss, _commingsoon.scss | ‚úÖ Yes | ‚ùå No |

**Root Cause:** Phase 11C changes are NOT visible because `style.scss` is not compiled. The static `style.css` is loaded instead.

---

## 2. STYLE.CSS vs STYLE.SCSS PARITY ANALYSIS

### 2.1 Font Imports

| Aspect | style.css | style.scss |
|--------|-----------|------------|
| Google Fonts Import | ‚úÖ Present (line 1) | ‚ö†Ô∏è Via _variables.scss or external |
| Font-Awesome | ‚úÖ Loaded via index.scss | ‚úÖ Same (external import) |
| Custom Fonts | ‚úÖ If any defined | ‚ö†Ô∏è Must verify in _variables.scss |

**Font Import in style.css (line 1):**
```css
@import url('https://fonts.googleapis.com/css2?family=...');
```

**Risk:** If `style.scss` does not include the same Google Fonts import, fonts may fail to load.

### 2.2 Vendor Prefixes

| Aspect | style.css (Static) | style.scss (Vite Compiled) |
|--------|-------------------|---------------------------|
| Prefix Method | Pre-generated | Autoprefixer (PostCSS) |
| -webkit- prefixes | ‚úÖ Included | ‚ö†Ô∏è Depends on browserslist |
| -moz- prefixes | ‚úÖ Included | ‚ö†Ô∏è Depends on browserslist |
| -ms- prefixes | ‚úÖ Included | ‚ö†Ô∏è Depends on browserslist |

**Risk:** Vite's autoprefixer may generate different prefixes than the static CSS, potentially causing cross-browser inconsistencies.

### 2.3 Media Query Structure

| Aspect | style.css | style.scss |
|--------|-----------|------------|
| Breakpoints | Hardcoded values | Via $variables or direct |
| Mobile-first | Yes | Must verify |
| Query consolidation | Pre-merged | Vite may or may not merge |

**Note:** SCSS compilation may output media queries in a different order than the static CSS.

### 2.4 Compilation Approach Differences

| Aspect | style.css | style.scss via Vite |
|--------|-----------|---------------------|
| Minification | Not minified (dev) | Configurable |
| Source Maps | None | Generated by Vite |
| Variable Resolution | Already resolved | Resolved at compile time |
| Nesting | Flattened | Flattened by SCSS compiler |

---

## 3. RISK REGISTER

### Risk R1: Font Loading Regression

| Field | Value |
|-------|-------|
| **Description** | Google Fonts or custom fonts fail to load after switching to style.scss |
| **Impact** | **HIGH** ‚Äî Visible font fallback, brand inconsistency |
| **Detection Method** | Visual inspection of typography on all routes; DevTools Network tab |
| **Rollback Strategy** | Revert index.scss line 21 to `@import url('./assets/sass/style.css');` |

### Risk R2: Layout Spacing Changes

| Field | Value |
|-------|-------|
| **Description** | Margin, padding, or gap values differ between compiled outputs |
| **Impact** | **MEDIUM** ‚Äî Visual regression, alignment issues |
| **Detection Method** | Side-by-side comparison of key pages; overlay diff tool |
| **Rollback Strategy** | Immediate revert to style.css import |

### Risk R3: Vendor Prefix Differences

| Field | Value |
|-------|-------|
| **Description** | Missing or different vendor prefixes cause cross-browser issues |
| **Impact** | **MEDIUM** ‚Äî Affects Safari, older Edge, Firefox |
| **Detection Method** | Test in Safari, Firefox; check DevTools for unprefixed properties |
| **Rollback Strategy** | Revert import; document affected properties |

### Risk R4: Missing SCSS Imports

| Field | Value |
|-------|-------|
| **Description** | style.scss does not import all partials that style.css contains |
| **Impact** | **HIGH** ‚Äî Missing component styles, broken layouts |
| **Detection Method** | SCSS compilation errors; visual scan of all components |
| **Rollback Strategy** | Revert import; audit style.scss imports vs style.css sections |

### Risk R5: Build Performance Impact

| Field | Value |
|-------|-------|
| **Description** | SCSS compilation adds significant build time |
| **Impact** | **LOW** ‚Äî Developer experience only, not runtime |
| **Detection Method** | Measure Vite build time before/after |
| **Rollback Strategy** | Accept if under 5s increase; otherwise evaluate caching |

### Risk R6: CSS Variable Cascade Conflicts

| Field | Value |
|-------|-------|
| **Description** | `var(--theme-color)` references conflict with undefined root variables |
| **Impact** | **MEDIUM** ‚Äî Fallback colors used, visual inconsistency |
| **Detection Method** | DevTools computed styles; search for "invalid value" |
| **Rollback Strategy** | Ensure `:root { --theme-color: #D90A2C; }` is defined in index.scss |

---

## 4. PHASED EXECUTION PROPOSAL

### Phase W1: Wiring Switch Pilot

| Field | Value |
|-------|-------|
| **Objective** | Switch apps/public from style.css to style.scss and verify compilation |
| **Scope** | Modify ONE line in `apps/public/src/index.scss` (line 21) |
| **Exact Change** | `@import url('./assets/sass/style.css');` ‚Üí `@import './assets/sass/style.scss';` |
| **Pre-Requisite** | Create restore point document before modification |
| **Acceptance Criteria** | SCSS compiles without errors; Vite dev server starts successfully |
| **Hard Stop Condition** | ANY SCSS compilation error ‚Üí IMMEDIATE ROLLBACK |

**Deliverable:** Compilation status report (PASS/FAIL)

---

### Phase W2: Visual Parity Scan

| Field | Value |
|-------|-------|
| **Objective** | Verify visual parity between style.css and compiled style.scss |
| **Scope** | All public app routes (see route list below) |
| **Environment** | Local Vite dev server (`cd apps/public && npm run dev`) |
| **Acceptance Criteria** | No layout regressions; no font changes; only Phase 11C color surfaces differ |
| **Hard Stop Condition** | ANY visual regression beyond Phase 11C scope ‚Üí IMMEDIATE ROLLBACK |

**Routes to Scan:**

| Route | Check Areas |
|-------|-------------|
| `/` | Hero, header, footer, buttons, links |
| `/about` | Section spacing, typography, team cards |
| `/service` | Service cards, hover states, icons |
| `/service-details/:slug` | Detail layout, sidebar, CTA |
| `/project` | Portfolio grid, filters, hover overlays |
| `/project-details/:slug` | Gallery, process steps, related projects |
| `/blog` | Article cards, pagination, sidebar |
| `/blog/:slug` | Post content, comments, share buttons |
| `/contact` | Form styling, map, contact info |

**Deliverable:** PASS/FAIL table per route with notes

---

### Phase W3: Acceptance / Rollback Decision

| Field | Value |
|-------|-------|
| **Objective** | Make final decision: accept SCSS wiring or rollback to CSS |
| **Scope** | Review Phase W2 results; consult stakeholder if needed |
| **Acceptance Criteria** | All routes PASS; 0 console errors; 0 SCSS warnings; Phase 11C colors visible |
| **Hard Stop Condition** | ANY unresolved regression ‚Üí ROLLBACK and document |

**Decision Matrix:**

| Scenario | Action |
|----------|--------|
| All routes PASS, Phase 11C visible | ‚úÖ Accept wiring; mark Phase 11C complete |
| Minor issues, fixable | ‚ö†Ô∏è Document issues; create Phase 11C-4 for fixes |
| Major regressions | ‚ùå Rollback; re-evaluate approach |

**Deliverable:** Final decision document with rationale

---

## 5. ROLLBACK PLAN

### 5.1 Exact Rollback Step

**File:** `apps/public/src/index.scss`  
**Line:** 21  
**Revert To:**
```scss
@import url('./assets/sass/style.css');
```

### 5.2 Rollback Confirmation

| Aspect | Confirmation |
|--------|--------------|
| Single line change | ‚úÖ Yes ‚Äî only line 21 modified |
| Immediate effect | ‚úÖ Yes ‚Äî Vite hot-reload restores CSS |
| Side effects | ‚ùå None ‚Äî style.css is unchanged |
| SCSS partials preserved | ‚úÖ Yes ‚Äî no SCSS files are modified during rollback |

### 5.3 Post-Rollback State

After rollback:
- Public app loads static `style.css` (original behavior)
- Phase 11C SCSS changes remain in partials (preserved for future)
- No visual difference from pre-Phase-W1 state

---

## 6. CONSTRAINTS (NON-NEGOTIABLE)

| Constraint | Status |
|------------|--------|
| Do NOT modify fonts | üîí LOCKED |
| Do NOT modify Darkone admin CSS/SCSS | üîí LOCKED |
| Do NOT create new CSS/SCSS files | üîí LOCKED |
| Do NOT refactor SCSS structure | üîí LOCKED |
| Do NOT modify layouts | üîí LOCKED |
| Do NOT introduce new color tokens | üîí LOCKED |

---

## 7. AUTHORIZATION GATE

| Gate | Status |
|------|--------|
| Document reviewed by stakeholder | ‚è≥ PENDING |
| Phase W1 authorized | ‚ùå NOT YET |
| Phase W2 authorized | ‚ùå NOT YET |
| Phase W3 authorized | ‚ùå NOT YET |

**Next Action:** Await stakeholder review and explicit authorization to proceed with Phase W1.

---

## DOCUMENT END

**Status:** Draft  
**Execution:** BLOCKED ‚Äî Awaiting authorization  
**Hard Stop:** Active
