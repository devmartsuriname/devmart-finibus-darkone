# Phase 4 — Module: Media Library

```
Status: ✅ COMPLETE
Phase: Phase 4A.2 Complete
Execution: Seeding Verified — 38 Assets
Last Updated: 2025-12-22
```

---

## 1. Module Overview

| Attribute | Value |
|-----------|-------|
| Module Name | Media Library |
| Admin Route | `/content/media` |
| Public Routes | N/A (asset storage) |
| Current State | ✅ Admin UI Implemented (Phase 4A.2) |
| Priority | 1 (enables other modules) |

---

## 2. Frontend Reference

### 2.1 Mapping Index Reference

See: `Phase_4_Frontend_Mapping_Index.md` Section 9

### 2.2 Public Display

Media Library has **no public-facing route**. It serves as the central asset storage for:

| Consumer Module | Asset Type |
|-----------------|------------|
| Blog | Featured images, author avatars |
| Projects | Portfolio images, thumbnails |
| Testimonials | Client photos |
| Pages | Section images, banners |

### 2.3 Current Asset Directories (Finibus)

| Directory | Sample Files | Count |
|-----------|--------------|-------|
| `/images/author/` | author-1.jpg through author-7.jpg | ~7 |
| `/images/post/` | post-1.jpg through post-8.jpg | ~8 |
| `/images/portfolio/` | portfolio-1.jpg through portfolio-9.jpg | ~9 |
| `/images/project/` | Various project images | TBD |
| `/images/icons/` | Service icons | TBD |

---

## 3. Data Model (Implemented)

### 3.1 Table: `media`

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | uuid | No | gen_random_uuid() | Primary key |
| `filename` | text | No | — | Original filename |
| `storage_path` | text | No | — | Path in storage bucket |
| `public_url` | text | No | — | Public access URL |
| `file_type` | text | No | — | MIME type (image/jpeg, etc.) |
| `file_size` | integer | No | — | Size in bytes |
| `alt_text` | text | Yes | NULL | Accessibility text |
| `title` | text | Yes | NULL | Display title |
| `uploaded_by` | uuid | Yes | auth.uid() | Reference to profiles |
| `created_at` | timestamptz | No | now() | Upload timestamp |
| `updated_at` | timestamptz | No | now() | Last modified |

### 3.2 Storage Bucket Configuration

| Bucket | Access | Purpose |
|--------|--------|---------|
| `media` | **PUBLIC** | Media library files |

**Important:** Bucket is PUBLIC. Files have permanent public URLs via `getPublicUrl()`.

### 3.3 RLS Policies (Active)

| Policy | Operation | Condition |
|--------|-----------|-----------|
| Public read | SELECT | `true` |
| Authenticated insert | INSERT | Authenticated |
| Owner update | UPDATE | `auth.uid() = uploaded_by` |
| Admin delete | DELETE | `has_role(auth.uid(), 'admin')` |

---

## 4. Seeding Plan

### 4.1 Seed Data Requirement

| Attribute | Value |
|-----------|-------|
| **Required** | **YES** |
| **Reason** | Media must be seeded first so Blog, Projects, Testimonials, and Pages can reference image sources consistently. |

### 4.2 Media Seed Pack Definition

**Source:** Finibus template assets ONLY (`apps/public/src/assets/images/`)

**Folder Convention (Canonical):**

| Folder | Purpose | Source Directory |
|--------|---------|------------------|
| `finibus/hero/` | Homepage hero section | `/images/hero/` |
| `finibus/blog/` | Blog featured images | `/images/post/` |
| `finibus/portfolio/` | Project thumbnails | `/images/portfolio/` |
| `finibus/masonary/` | Portfolio grid | `/images/masonary/` |
| `finibus/avatars/` | Author and client photos | `/images/author/` |
| `finibus/clients/` | Testimonial client photos | `/images/client/` |
| `finibus/icons/` | Service icons | `/images/icons/` |
| `finibus/backgrounds/` | Page backgrounds | `/images/backgrounds/` |
| `finibus/logos/` | Brand assets | `/images/logo/` |

### 4.3 Minimum Asset Count

| Category | Minimum Count | Priority |
|----------|---------------|----------|
| Hero Images | 3 | High |
| Blog Featured | 8 | High |
| Portfolio | 9 | High |
| Masonary | 12 | Medium |
| Avatars | 7 | High |
| Client Photos | 3 | High |
| Service Icons | 7 | Medium |
| Backgrounds | 4 | Low |
| Logos | 3 | High |
| **TOTAL** | **56** | — |

**Hard Minimum:** 30 assets (covering high-priority categories)

### 4.4 Naming Convention

```
{category}-{number}.{ext}
```

Examples:
- `hero-1.jpg`
- `blog-post-1.jpg`
- `portfolio-1.jpg`
- `avatar-author-1.jpg`
- `client-1.jpg`
- `service-icon-1.png`

### 4.5 Required Metadata

| Field | Required | Rule |
|-------|----------|------|
| `filename` | Yes | Original filename preserved |
| `alt_text` | **Yes** | Descriptive text for accessibility (must not be empty) |
| `title` | Recommended | Display-friendly name |
| `file_type` | Yes | MIME type (auto-detected) |
| `storage_path` | Yes | Folder convention + filename |
| `public_url` | Yes | Generated by Supabase |

### 4.6 Seeding Method

**Recommended:** Manual upload via Admin UI

**Rationale:**
- Validates upload flow
- Ensures RLS policies work
- Admin enters alt_text for each asset
- No migration scripts to maintain

**Alternative (if volume is too high):** SQL seed migration with pre-defined metadata. Requires explicit authorization.

### 4.7 Acceptance Criteria

- [x] At least 30 assets uploaded to Supabase Storage — **38 assets seeded**
- [x] All assets organized by folder convention (`finibus/{category}/`)
- [x] All assets appear in Media Library list — **Verified**
- [x] Each asset has `alt_text` populated (not null or empty)
- [x] Each asset has correct `file_type` (MIME)
- [x] `public_url` resolves correctly in browser
- [x] Admin can delete files — **Verified via RLS**
- [x] Assets can be referenced by other modules (Blog, Projects, Testimonials)

---

## 5. Admin UI Requirements

### 5.1 Screens (Implemented)

| Screen | Route | Description | Status |
|--------|-------|-------------|--------|
| List | `/content/media` | Display all media in table view | ✅ |
| Upload Modal | (modal) | Dropzone for file upload | ✅ |
| Delete Modal | (modal) | Confirm deletion | ✅ |

### 5.2 List View Features

| Feature | MVP | Status |
|---------|-----|--------|
| Table with thumbnails | ✅ | Implemented |
| Filter by file type | ✅ | UI only |
| Search by filename/title | ✅ | UI only |
| Sort by date | ✅ | Implemented |
| Pagination | ✅ | Not yet |
| Bulk delete | — | Later |
| Folder organization | — | Later |

### 5.3 Upload Features

| Feature | MVP | Status |
|---------|-----|--------|
| Drag-and-drop upload | ✅ | Implemented |
| Single file upload | ✅ | Implemented |
| Progress indicator | ✅ | Implemented |
| File type validation | ✅ | Implemented |
| Size limit enforcement | ✅ | Implemented (10MB) |

### 5.4 Validation Rules

| Rule | Constraint |
|------|------------|
| File types | image/jpeg, image/png, image/gif, image/webp, application/pdf |
| Max file size | 10MB per file |
| Filename | Sanitized on upload (alphanumeric, hyphens, underscores) |
| Alt text | Max 255 characters |
| Title | Max 255 characters |

---

## 6. Phase Gate

### 6.1 Implementation Status

| Step | Scope | Status |
|------|-------|--------|
| Step 1 | Create `media` table, storage bucket, RLS policies | ✅ Complete |
| Step 2 | Admin CRUD: upload, list, delete | ✅ Complete |
| Step 3 | Seeding: Upload Media Seed Pack | ✅ **Complete — 38 assets** |
| Step 4 | Integration: Media picker component for other modules | ⏳ Pending |

### 6.2 Verification Results (2025-12-22)

| Check | Result |
|-------|--------|
| Preflight fetch | ✅ 200 OK |
| Storage objects | ✅ 38 files |
| DB rows | ✅ 38 rows |
| Media Library UI | ✅ Displays all files |
| Admin delete | ✅ Verified |

### 6.3 Seeding Completion

- [x] `media` table created
- [x] Storage bucket configured (PUBLIC)
- [x] RLS policies applied (including admin INSERT + UPDATE)
- [x] Upload functionality tested
- [x] Admin UI implemented
- [x] Seeding executed — **38 assets**
- [x] Media Library verified — **All assets visible**

---

## 7. Dependencies

### 7.1 Required Before This Module

| Dependency | Status |
|------------|--------|
| Supabase Cloud enabled | ✅ Active |
| Storage configured | ✅ Active |
| Admin auth working | ✅ Active |

### 7.2 Modules Dependent on This

| Module | Dependency Type |
|--------|-----------------|
| Blog | Featured images, author avatars |
| Projects | Portfolio images |
| Testimonials | Client photos |
| Pages | Section images |

---

## 8. Admin UI Standard Reference

See: `Phase_4_Admin_UI_Standard.md`

This module follows all patterns defined in the Admin UI Standard:
- Page header with "Add Media" button at top-right
- Table with thumbnail, filename, type, size, date, actions columns
- Empty state with icon, message, and CTA
- Upload modal with dropzone
- Delete confirmation modal
- Toast notifications for success/error

---

## Document Control

| Version | Date | Author | Notes |
|---------|------|--------|-------|
| 0.1 | 2025-12-21 | Planning Agent | Initial draft |
| 1.0 | 2025-12-22 | Planning Agent | Added Seeding Plan (REQUIRED) |
| 2.0 | 2025-12-22 | Implementation Agent | ✅ Phase 4A.2 Complete — Seeding verified (38 assets) |

**Next Review:** After Blog/Projects module authorization
